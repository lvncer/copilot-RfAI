# プロジェクトのための全体の手順

最初に設計書をもとにタスク分解を行います。
タスク分解をしたものをタスクリストファイルに登録します。
タスク分解で分けたものを 1 タスクとします。
1 タスクは GitHub Copilot に読み込ませるのに適切な大きさです。

[繰り返し]
1 タスクを元に詳細な情報を載せたプロンプトファイルを作成します。
開発者は、プロンプトファイルに詳細な実装のための情報を補強します。
開発者と GitHub Copilot の双方が確認したプロンプトファイルを利用して機能を追加していきます。
GitHub Copilot はコードを生成します。
生成されたコードに技術的負債がないかを確認します。
実装後、ユニットテスト、結合テスト、E2E テスト等を行います。
問題があれば、リファクタリングを行います。
ソースコードだけを見てもらってコードの批判と分析をしてもらいます。
レビューをします。

設計書の最後まで、これを繰り返します。

最初に Web アプリの**設計書**を作っておきます。
設計書から**タスクリストファイル**や GitHub Copilot への**指示書・プロンプトファイル**を作成します。

## フォルダ・ファイルの種類

設計書(複数)
タスクリストファイル: タスク一覧
指示書 全体の指示書(1 ファイル): プロジェクト全体で共通する指示
指示書 個別の指示書(複数): 全体の指示書ではかけなかった個別の指示
指示書 プロンプトファイル(複数): タスクの実装詳細情報
指示書 メモリーファイル(1 ファイル): 実行履歴

## タスク管理

### タスクリストファイルの作成と更新

1. **設計書の確認とタスク分解**:

   - 最初に設計書を確認します。
   - 設計書の場所は **design/** にあります。
   - 設計書を元に、1 機能単位にタスク分解を行います。
   - タスク分解したものをタスクリストファイルに登録します。

2. **タスクリストファイルの管理**:
   - `task-list.prompt.md` ファイルを作成、編集、更新します。
   - それぞれのタスクにタスク ID を割り当てます。
   - 現在のタスク、これから行うタスクを記録します。
   - 完了したタスクは、終了後すぐに `task-list.prompt.md` にチェックマークを付けます。
   - 開発中に発見された新しいタスクや TODO は、`task-list.prompt.md` の「作業中に発見」セクションに追加します。

### プロンプトファイルの作成と実行

1. **プロンプトファイルの作成**:

   - タスクリストファイルから、1 タスク 1 機能ごとにプロンプトファイルを作成します。
   - 1 プロンプトファイルは 1 機能 1 タスクを守ります。
   - タスクリストファイルから 1 タスクを取り出した時、以下の命名規則でプロンプトファイルを作成します。
   - プロンプトファイルの命名規則

   プロンプトファイルのフォーマット
   `.github/prompts/[YYYYMMDD]-[タスクid]-[タスク名]-[タスクの種類].prompt.md`

   例: `20240426-123-loginFeature-feat.prompt.md`

   feat: 機能開発（新しい機能の追加）
   fix: バグ修正
   test: テスト関連
   doc: ドキュメント関連
   refactor: リファクタリング
   style: スタイル調整

2. **プロンプトファイルの実行**:
   - 指示されたプロンプトファイルに基づいてファイル内に書いてある指示を実行します。
   - プロンプトファイルの実行前に `task-list.prompt.md` を確認します。
   - プロンプトファイルの実行時に `copilot-instructions.md` に記述されているルールに従います。
   - プロンプトファイルの実行後、「プロンプトファイル完了後の処理」の指示に従います。

### プロンプトファイル完了後の処理

1. **タスクリストファイルの更新**:

   - 完了したタスクは、終了後すぐに `task-list.prompt.md` にマークします。
   - GitHub Copilot は `task-list.prompt.md` を更新します。
     - 例: 「`task-list.prompt.md` の〇〇が完了したのでチェックし、△△ を新しいタスクとして追加してください。」

2. **コードレビューと改善**:
   - プロジェクトの背景情報を一切見ずに、ソースコードだけを読み、ソースコードや設計を批判します。
   - すべての deprecated のコードを削除します。
   - 新しい仕組みへの中間状態を作らないようにします。
   - 技術的負債を徹底的に無くします。

### 技術的負債の定義と解消

- **技術的負債の定義**:

  - コードの重複
  - 複雑すぎるコード
  - テストがないコード
  - ドキュメントがないコード
  - パフォーマンスが悪いコード
  - セキュリティ上の問題があるコード

- **技術的負債の解消方法**:
  - リファクタリング
  - テストの追加
  - ドキュメントの作成
  - パフォーマンス改善
  - セキュリティ修正

## GitHub Copilot の動作ルール

- コンテキストが不明な場合は、質問してください。
- 存在しないライブラリや関数は使用せず、既知の、検証されたライブラリのみを使用してください。
- コードやテストで参照する前に、ファイルパスやモジュール名が存在することを確認してください。
- 明示的に指示されていない限り、または `task-list.prompt.md` のタスクに含まれていない限り、既存のコードを削除または上書きしないでください。
- プロジェクトの修正や変更を行う際は、一度に 1 つのタスクに集中してください。
- 変更、修正があった場合メモリーファイル `memory.md` を更新してください。
- コード変更後は、タスクリストファイル `task-list.prompt.md` を更新してください。

### メモリーファイル

メモリーファイル `memory.md` には、

- 開発環境、使用技術
- システムの構成、技術的判断、設計パターン
- プロジェクトの目的、解決する問題、期待される挙動
- 現在作業中の内容、最近の変更点、次のステップ
- 完成済みの機能、進捗状況、残りの作業
  を書いてください。

例

    ```memory.md
    [開発環境、使用技術]

    [システムの構成、技術的判断、設計パターン]

    [プロジェクトの目的、解決する問題、期待される挙動]

    [現在作業中の内容、最近の変更点、次のステップ]

    [完成済みの機能、進捗状況、残りの作業]

    ```

## 使用技術スタック

### フロントエンド

#### コアテクノロジー

- **Next.js** (最新安定板バージョン): React フレームワーク
- **React** (最新安定板バージョン): UI ライブラリ
- **TypeScript** (最新安定板バージョン): 型付き JavaScript

#### UI コンポーネント

- **Shadcn/ui** (最新安定板バージョン): 重点的に利用しましょう。
- **Tailwind CSS** (最新安定板バージョン): ユーティリティファースト CSS フレームワーク
  - tailwind-merge: クラス名の最適化
  - tailwindcss-animate: アニメーション機能
- **Radix UI**: アクセシブルなヘッドレス UI コンポーネント
  - Accordion, Alert Dialog, Avatar, Tabs など多数のコンポーネントを使用
- **Lucide React** (最新安定板バージョン): アイコンライブラリ

#### 認証

- **Clerk** (最新安定板バージョン): 認証・ユーザー管理

### バックエンド

#### データベース

- **Prisma** (最新安定板バージョン): TypeSafe ORM
  - @prisma/client: データベースクライアント
- **Local SqLite**(後に Supabase へ変更)

### フォーム処理

- **Server Actions**(with Next.js)
- **Zod** (最新安定板バージョン): スキーマバリデーション

### ユーティリティ

#### 日付処理

- **date-fns** (最新安定板バージョン): 日付操作ライブラリ

#### UI 拡張

- 適宜必要なものはインストールして利用してください。

### 開発ツール

- **ESLint** (最新安定板バージョン) - コード品質管理
- **Autoprefixer** (最新安定板バージョン) - CSS ベンダープレフィックス自動付与
- **PostCSS** (最新安定板バージョン) - CSS トランスフォーメーション

### デプロイメント

- Vercel プラットフォーム推奨

### 特徴

- Server Components 対応
- Incremental Static Regeneration (ISR)の実装
- レスポンシブデザイン
- アクセシビリティ対応
- 型安全性の確保

### コードのコメント

- コメント形式: JSDoc を使った明確なコンテキストを書いてください。
- コードを修正したらコメントも適切なものにしてください。
- 不要なコメントは削除してください。
- 食い違いのあるコメントは修正してください。

## UI に関する指示

### 1. デザインシステム

#### 重要度: 最高

- shadcn/ui をベースとしたコンポーネントの使用
- **既存の UI は承認なしでの変更を禁止**
- コンポーネントのカスタマイズは最小限に抑える

  ```typescript
  // ✅ 良い例：shadcn/uiコンポーネントをそのまま使用
  import { Button } from "@/components/ui/button";

  // ❌ 悪い例：不必要なカスタマイズ
  const CustomButton = styled(Button)`
    // 独自のスタイリング
  `;
  ```

### 2. スタイリング規約

#### 重要度: 高

#### Tailwind CSS の使用

- ユーティリティクラスを優先的に使用
- カスタムクラスは`@layer`で定義
- 命名規則は`kebab-case`を使用

```typescript
// ✅ 良い例
<div className="flex items-center justify-between p-4">

// ❌ 悪い例
<div style={{ display: 'flex', alignItems: 'center' }}>
```

### 3. レスポンシブデザイン

#### 重要度: 高

- モバイルファーストアプローチ
- Tailwind のブレークポイントを使用
  - sm: 640px
  - md: 768px
  - lg: 1024px
  - xl: 1280px
  - 2xl: 1536px

### 4. アクセシビリティ

#### 重要度: 高

- WAI-ARIA ガイドラインの遵守
- キーボード操作のサポート
- 適切なコントラスト比の確保
- スクリーンリーダー対応

### 5. アニメーションとトランジション

#### 重要度: 中

- `tailwindcss/animation`の使用
- 過度なアニメーションを避ける
- 必要な場合のみ`framer-motion`を使用

### 6. フォーム設計

#### 重要度: 高

- shadcn/ui のフォームコンポーネントを使用
- バリデーションメッセージは明確に表示
- 入力補助の実装（オートコンプリートなど）

### 7. 重要な制約事項

#### 重要度: 最高

1. UI 変更の制限

- **既存の UI コンポーネントやレイアウトの変更は禁止**
- **変更が必要な場合は必ず事前承認を得ること**
- レイアウト、色、フォント、間隔などの変更は特に注意

2. コンポーネントの追加

- 新規コンポーネントは shadcn/ui の設計原則に従う
- 既存のコンポーネントの再利用を優先

### 8. エラー表示とフィードバック

#### 重要度: 高

- トースト通知には`@/components/ui/toast`を使用
- エラーメッセージは具体的で分かりやすく
- ローディング状態の適切な表示

### 9. アイコンとイメージ

#### 重要度: 中

- Lucide Icons を標準として使用
- SVG アイコンの最適化
- 画像は`next/image`で最適化

### 10. ダークモード対応

#### 重要度: 高

- `dark:`プレフィックスでスタイリング
- システム設定との連動
- コントラスト比の維持

### 11. コンポーネント設計原則

#### 重要度: 高

- 単一責任の原則
- Props 経由での柔軟なカスタマイズ
- 適切なコンポーネント分割

  ```typescript
  // ✅ 良い例
  interface CardProps {
    title: string;
    children: React.ReactNode;
    className?: string;
  }

  // ❌ 悪い例
  interface CardProps {
    title: string;
    titleColor: string; // 不要なカスタマイズ
    customPadding: string; // 避けるべき
  }
  ```

### 注意事項

1. デザインの一貫性

   - コンポーネントライブラリの一貫した使用
   - カスタムスタイルの最小化
   - デザイントークンの遵守

2. パフォーマンス

   - 不要なアニメーションの削除
   - 画像の最適化
   - バンドルサイズの監視

3. 品質管理

   - コンポーネントのストーリーブック作成
   - ビジュアルリグレッションテスト
   - クロスブラウザテスト

4. ドキュメント

   - コンポーネントの使用例
   - Props の型定義
   - デザインシステムのガイドライン

これらのルールは、プロジェクトの一貫性と保守性を確保するために重要です。
変更が必要な場合は、必ずチームでの承認プロセスを経てください。

## セキュリティ

- `.env*` ファイルは git で管理しないでください。

## ドキュメント

- `README.md` には、使い方や説明などを記述してください。
- 変更内容は `README.md` に反映させてください。

## MCP (Model Context Protocol) の設定

- MCP の設定は `.vscode/mcp.json` にあります。
